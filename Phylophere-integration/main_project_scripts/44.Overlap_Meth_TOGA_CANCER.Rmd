---
title: "Species overlap between methylation-project derived annotations (Luca), TOGA assemblies and cancer datasets"
author: "Miguel Ramon"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

# Overlap of species between methylation-project derived annotations (Luca), TOGA assemblies and cancer datasets
This R Markdown document analyzes the overlap of primate species between datasets derived from methylation projects (Maria and Luca Wange), TOGA assemblies, and cancer datasets. The analysis includes data visualization and processing steps to prepare the dataset for further analysis.

---

## Setup and Directory Configuration
This section configures the working environment, sets directories, and loads necessary functions and libraries.

```{r setup, message=FALSE, warning=FALSE}
# Suppress warnings and messages in output
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
# Set the root directory for the project
knitr::opts_knit$set(root.dir = "/home/miguel/IBE-UPF/PhD/NEOPLASY_PRIMATES")
# Display current working directory
getwd()
# Set seed for reproducibility
set.seed(1998)
```

```{r dirdef, message=FALSE, warning=FALSE}
# Define working, data, and results directories
workingDir <- getwd()
dataDir <- file.path(workingDir, "Data")
resultsDir <- file.path(workingDir, "Malignancy_Primates/Out")

# Load libraries, common functions, primate-specific functions and objects
source(file.path(workingDir, "Malignancy_Primates/Scripts/functions/libraries.R"))
source(file.path(workingDir, "Malignancy_Primates/Scripts/functions/commons.R"))
source(file.path(workingDir, "Malignancy_Primates/Scripts/functions/primate_functions.R"))
source(file.path(workingDir, "Malignancy_Primates/Scripts/functions/primate_objects.R"))

# Note that all variables may be changed from COMMONS and PRIMATE_OBJECTS scripts.
```

## 1. Dataset Visualization
This section visualizes the distribution of primate species across families to provide an overview of the dataset.

```{r dataset_visualization, fig.height=7, fig.width=10, dev='png', dpi=320}
# Methylation data
methylation_data1 <- read.xlsx(file.path(dataDir, "MSA_assemblies.xlsx"), 1)
toga2 <- read.xlsx(file.path(dataDir, "MSA_assemblies.xlsx"), 6)
toga_stats <- read.xlsx(file.path(dataDir, "MSA_assemblies.xlsx"), 7)

overlap_data <- methylation_data1 %>%
  full_join(traits, by = c("species" = "species")) %>%
  # Filter species where malignant_prevalence is not NA
  filter(!is.na(malignant_prevalence)) %>%
  mutate(isDuplicate = duplicated(species) | duplicated(species)) %>%
  mutate(noData = ifelse(is.na(malignant_prevalence), "No Data", "Has Data"))

overlap_toga <- toga2 %>%
  mutate(species = scientific_name) %>%
  full_join(traits, by = c("species" = "species")) %>%
  filter(!is.na(malignant_prevalence)) %>%
  mutate(isDuplicate = duplicated(species) | duplicated(species))

dedup_overlap_toga <- overlap_toga %>%
  filter(!isDuplicate)
dedup_overlap_data <- overlap_data %>%
  filter(!isDuplicate)

# Extract a report
report <- data.frame(
  Dataset = c("Methylation_Project", "TOGA_Assemblies"),
  Total_Species = c(nrow(overlap_data), nrow(overlap_toga)),
  Unique_Species = c(nrow(dedup_overlap_data), nrow(dedup_overlap_toga))
)

```
